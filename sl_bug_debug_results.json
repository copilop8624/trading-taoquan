{
  "timestamp": "2025-09-19T17:59:40.441349",
  "bug_description": "SL=2.75% allows losses exceeding -9%",
  "debug_results": [
    {
      "trade_id": "T001",
      "input_params": {
        "entry_price": 0.0095,
        "exit_price": 0.008587,
        "side": "LONG",
        "sl_percent": 2.75
      },
      "calculations": {
        "sl_price": 0.00923875,
        "expected_max_loss": -2.75,
        "actual_pnl": -9.61052631578948
      },
      "logic_checks": {
        "sl_should_trigger": true,
        "actual_loss_exceeds_sl": true,
        "exit_vs_sl": "Exit 0.008587 vs SL 0.009239",
        "exit_below_sl": true
      },
      "potential_issues": [
        "\ud83d\udea8 CRITICAL: Actual loss exceeds SL limit!",
        "Expected max loss: -2.75%, Actual: -9.61%",
        "\ud83d\udc1b BUG: SL should have triggered but loss exceeded limit"
      ],
      "conclusion": "\ud83d\udea8 SIMULATION BUG DETECTED - SL logic failure"
    },
    {
      "trade_id": "T002",
      "input_params": {
        "entry_price": 0.0092,
        "exit_price": 0.008611,
        "side": "LONG",
        "sl_percent": 2.75
      },
      "calculations": {
        "sl_price": 0.008947,
        "expected_max_loss": -2.75,
        "actual_pnl": -6.40217391304347
      },
      "logic_checks": {
        "sl_should_trigger": true,
        "actual_loss_exceeds_sl": true,
        "exit_vs_sl": "Exit 0.008611 vs SL 0.008947",
        "exit_below_sl": true
      },
      "potential_issues": [
        "\ud83d\udea8 CRITICAL: Actual loss exceeds SL limit!",
        "Expected max loss: -2.75%, Actual: -6.40%",
        "\ud83d\udc1b BUG: SL should have triggered but loss exceeded limit"
      ],
      "conclusion": "\ud83d\udea8 SIMULATION BUG DETECTED - SL logic failure"
    }
  ],
  "recommendations": {
    "immediate_fixes": [
      "\ud83d\udd27 Check simulate_trade() function SL trigger logic",
      "\ud83d\udd27 Verify candle data matching and datetime alignment",
      "\ud83d\udd27 Audit entry/exit price calculation accuracy",
      "\ud83d\udd27 Check if SL calculation uses correct entry price",
      "\ud83d\udd27 Verify side (LONG/SHORT) handling in SL logic"
    ],
    "code_locations_to_check": [
      "simulate_trade() in backtest_gridsearch_slbe_ts_Version3.py",
      "find_candle_idx() datetime matching logic",
      "SL trigger conditions in simulation loop",
      "Price data extraction from candles",
      "PnL calculation formulas"
    ],
    "testing_strategy": [
      "Create manual step-by-step simulation for failing trades",
      "Add extensive logging to simulation engine",
      "Compare simulation results with raw tradelist",
      "Test with simplified data to isolate bug",
      "Validate candle data integrity"
    ]
  }
}