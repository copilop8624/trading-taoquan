I. YÊU CẦU CỐT LÕI CỦA MÔ PHỎNG CHUẨN THỰC CHIẾN
1. Diễn biến theo từng cây nến (candle-by-candle)
Không được dùng OHLC tùy tiện hoặc lấy giá chốt là giả định.
Lệnh phải được xử lý tuần tự theo thứ tự thời gian nến: vào → chờ giá chạy → chạm TP/SL/... → thoát.
✅ Bạn nên kiểm tra lại đoạn mô phỏng có đúng thứ tự thời gian chưa.

2. Thứ tự ưu tiên khi xảy ra nhiều ngưỡng giá trong 1 cây nến
Khi 1 cây nến chạm nhiều mức như SL, TP1, trailing... cần mô phỏng:
Thứ tự giá chạy trong nến: Open → High → Low → Close (với lệnh Long), hoặc Open → Low → High → Close (với Short)
Áp dụng thứ tự để xác định chính xác: chạm SL trước hay TP trước?
✅ Cực kỳ quan trọng để tránh tính "ảo" lãi khi thực tế đã bị SL từ sớm.

3. Logic đóng lệnh
SL hit: đóng toàn bộ lệnh
Trailing hit: đóng toàn bộ lệnh
Nếu có Entry ngược chiều, lệnh cũ bị đóng tại giá Open cây tín hiệu mới
(nhiều hệ thống không để ý phần này → sai hoàn toàn).

✅ Phải có mô phỏng logic Entry ngược chiều đóng lệnh cũ trước khi mở lệnh mới.

⚙️ II. THÔNG SỐ PHẢI ĐƯỢC MÔ PHỎNG THỰC TẾ, KHÔNG ĐƯỢC ĐẶT CỨNG
4. SL (stop-loss):
Không được đặt cảm tính.
Nên xác định vùng hợp lý từ thống kê Drawdown của các lệnh trước đó.
Mô phỏng lại xem nếu đặt SL quá ngắn thì sẽ hay bị quét – cần có tradeoff.

5. SLBE (stop-loss break-even):
Kiểm tra logic: khi nào thì dời SL về Entry? Sau khi chạy được X %?
Nếu giá hồi về Entry sau đó thì lệnh có đóng đúng lúc đó.
6. Trailing stop (TS):
Khi bắt đầu kích hoạt trailing phải đúng?
trailing_dist có mô phỏng theo đúng khoảng chạy của giá không?
trailing hit → giá có đảo chiều đủ sâu không? Đóng lệnh đúng chưa?
✅ Rất nhiều tool giả định trailing quá "trơn tru" khiến kết quả bị ảo.

📊 III. DỮ LIỆU CẦN KIỂM TRA
8. Dữ liệu đầu vào
Nến có đủ thông tin (Open, High, Low, Close theo đúng thời điểm không)?
Tradelist chỉ lấy dòng Entry long/short là vào lệnh, dòng có Exit là thoát lệnh trade đó.
Dữ liệu phải được khớp chính xác từng timestamp.

📈 IV. THỐNG KÊ & KẾT QUẢ
9. Thống kê sau mô phỏng
PnL thực tế từng lệnh
Số lệnh hit trailing, bị SL...
Drawdown trung bình, run-up trung bình
Có đồ thị tăng trưởng PnL tích luỹ không?

🧠 V. ĐỀ XUẤT QUY TRÌNH CHUẨN CHO TOOL MÔ PHỎNG
Đọc tradelist và candles → gom theo từng lệnh Entry

Với mỗi Entry:

Tìm vùng nến sau đó đến khi thoát (SL, trailing, hoặc Entry ngược)

Mô phỏng cây nến từng bước: Open → High/Low → trailing update → exit
Cập nhật lệnh đóng đúng logic
Tính PnL từng phần: TP, trailing...
Lưu thống kê
Lặp lại toàn bộ tradelist
Xuất kết quả: PnL, winrate, heatmap TS/SL/SLBE...

✅ KẾT LUẬN
Các yếu tố ưu tiên nhất:

Thứ tự giá chạy trong từng cây nến
Đóng lệnh theo đúng logic Entry ngược chiều, TP/SL/trailing
Không giả định giá – mô phỏng theo cây nến thực
Thông số TS, SL, SLBE phải dựa theo thống kê – không đặt cứng